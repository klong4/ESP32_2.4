[env:teensy40]
platform = teensy
board = teensy40
framework = arduino

monitor_speed = 115200
upload_speed = 2000000

; Dependencies
lib_deps =
    lvgl/lvgl@^9.2.2  ; LVGL graphics library

; Build flags
build_flags =
    -DLV_CONF_INCLUDE_SIMPLE
    -I./
    -Os  ; Optimize for size instead of speed
    -DTEENSY40
    -DDISPLAY_ST7789_PARALLEL  ; Active display: DISPLAY_ST7789 (SPI), DISPLAY_ST7789_PARALLEL (8/16-bit), or DISPLAY_ST7262 (24-bit RGB)
    -DLV_USE_DRAW_SW_ASM=LV_DRAW_SW_ASM_NONE  ; Disable ARM assembly optimizations
    -ffunction-sections  ; Place each function in its own section
    -fdata-sections  ; Place each data in its own section
    -Wl,--gc-sections  ; Remove unused sections during linking
    -fno-exceptions  ; Disable C++ exceptions
    -fno-rtti  ; Disable C++ RTTI

; Exclude sample code folders (deploying main cable tester UI)
build_src_filter = 
    +<*>
    -<sample/>
    -<test_peripherals.cpp>
    -<main.cpp>
    -<test_display_simple.cpp>
    -<test_data_pins.cpp>
    -<test_display_modes.cpp>
    -<boot_splash_data.c>

; Exclude Helium assembly optimization (not compatible with Teensy)
lib_ignore =
    lvgl/draw/sw/blend/helium

; Exclude problematic LVGL files
lib_ldf_mode = deep
lib_compat_mode = strict
build_unflags = 
    -Werror

; Board configuration
board_build.mcu = imxrt1062
board_build.f_cpu = 600000000L

; USB Type (Serial for debugging)
board_build.usbtype = serial
